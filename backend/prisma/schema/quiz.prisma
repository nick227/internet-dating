model Quiz {
  id        BigInt   @id @default(autoincrement())
  slug      String   @unique
  title     String
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  questions QuizQuestion[]
  results   QuizResult[]
  feedQuestions FeedQuestion[]
  tags      QuizTag[]
}

model QuizTag {
  id    BigInt @id @default(autoincrement())
  slug  String @unique
  label String
  quizzes Quiz[]
}

model QuizQuestion {
  id        BigInt   @id @default(autoincrement())
  quizId    BigInt
  prompt    String   @db.Text
  order     Int
  quiz      Quiz @relation(fields: [quizId], references: [id])
  feedQuestions FeedQuestion[]
  options   QuizOption[]
  @@unique([quizId, order])
}

model QuizOption {
  id          BigInt @id @default(autoincrement())
  questionId  BigInt
  label       String
  value       String
  order       Int
  traitValues Json?  // Map of trait keys to weights (-10 to +10), e.g. {"personality.funny": 2, "personality.nice": -5}
  question    QuizQuestion @relation(fields: [questionId], references: [id])
  @@unique([questionId, order])
}

model QuizResult {
  id        BigInt   @id @default(autoincrement())
  userId    BigInt
  quizId    BigInt
  answers   Json
  scoreVec  Json?
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
  user      User @relation(fields: [userId], references: [id])
  quiz      Quiz @relation(fields: [quizId], references: [id])
  @@unique([userId, quizId])
}
