model JobRun {
  id                  BigInt       @id @default(autoincrement())
  jobName             String
  status              JobRunStatus @default(QUEUED)
  trigger             JobTrigger
  scope               String?
  algorithmVersion    String?
  attempt             Int          @default(1)
  queuedAt            DateTime     @default(now())
  startedAt           DateTime?
  finishedAt          DateTime?
  durationMs          Int?
  queueDelayMs        Int?
  error               String?      @db.Text
  metadata            Json?
  triggeredBy         BigInt?
  cancelRequestedAt   DateTime?
  cancelRequestedBy   BigInt?
  lastHeartbeatAt     DateTime?
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt

  @@index([jobName, status])
  @@index([jobName, queuedAt])
  @@index([status, queuedAt])
  @@index([triggeredBy])
  @@index([status, lastHeartbeatAt])
}

model WorkerInstance {
  id              String    @id @default(uuid()) @db.VarChar(36)
  workerType      String    @default("job_worker") @db.VarChar(50)
  status          String    @default("STARTING") @db.VarChar(20) // STARTING, RUNNING, STOPPING, STOPPED
  hostname        String?   @db.VarChar(255)
  pid             Int?
  startedAt       DateTime  @default(now())
  lastHeartbeatAt DateTime  @default(now())
  stoppedAt       DateTime?
  jobsProcessed   Int       @default(0)
  metadata        Json?

  @@index([workerType, status])
  @@index([lastHeartbeatAt])
  @@map("WorkerInstance")
}
